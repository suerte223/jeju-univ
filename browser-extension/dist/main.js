(()=>{const e=document.querySelector(".form-data"),t=document.querySelector(".region-name"),o=document.querySelector(".api-key"),n=document.querySelector(".errors"),l=document.querySelector(".loading"),a=document.querySelector(".result-container"),r=document.querySelector(".result"),s=document.querySelector(".carbon-usage"),c=document.querySelector(".fossil-fuel"),i=document.querySelector(".my-region"),y=document.querySelector(".clear-btn");async function d(t,o){try{const e=await fetch(`https://api.electricitymaps.com/v3/carbon-intensity/latest?zone=${o}`,{method:"GET",headers:{"auth-token":t}});if(!e.ok)throw new Error(`API request failed: ${e.status}`);const r=await e.json();let y=Math.round(r.carbonIntensity);(e=>{let t=[0,150,600,750,800],o=t.sort((t,o)=>Math.abs(t-e)-Math.abs(o-e))[0],n=["#2AA364","#F5EB4D","#9E4229","#381D02","#381D02"][t.findIndex(e=>e>o)];chrome.runtime.sendMessage({action:"updateIcon",value:{color:n}})})(y),l.style.display="none",a.style.display="block",n.textContent="",i.textContent=o,s.textContent=`${y} grams (grams COâ‚‚ emitted per kilowatt hour)`,r.fossilFuelPercentage?c.textContent=r.fossilFuelPercentage.toFixed(2)+"% (percentage of fossil fuels used to generate electricity)":c.textContent=""}catch(t){console.error("Error fetching carbon data:",t),l.style.display="none",a.style.display="none",n.style.display="block",n.textContent="Sorry, we couldn't fetch data for that region.",e.style.display="block",y.style.display="none",r.style.display="none",localStorage.removeItem("apiKey"),localStorage.removeItem("regionName")}}function u(){const t=localStorage.getItem("apiKey"),o=localStorage.getItem("regionName");chrome.runtime.sendMessage({action:"updateIcon",value:{color:"green"}}),null===t||null===o?(e.style.display="block",r.style.display="none",l.style.display="none",y.style.display="none",n.textContent=""):(e.style.display="none",r.style.display="block",l.style.display="block",a.style.display="none",y.style.display="block",d(t,o))}e.addEventListener("submit",s=>function(s){s.preventDefault(),function(t,o){localStorage.setItem("apiKey",t),localStorage.setItem("regionName",o),e.style.display="none",r.style.display="block",l.style.display="block",a.style.display="none",n.textContent="",y.style.display="block",d(t,o)}(o.value,t.value)}(s)),y.addEventListener("click",e=>function(e){e.preventDefault(),localStorage.removeItem("regionName"),localStorage.removeItem("apiKey"),u()}(e)),u()})();